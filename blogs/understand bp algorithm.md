# åå‘ä¼ æ’­ï¼ˆBPï¼‰ç®—æ³•çš„ä¸€ç§ç®€å•ç†è§£

åå‘ä¼ æ’­ç®—æ³•æ˜¯ç¥ç»ç½‘ç»œä¸­çš„ç»å…¸ç®—æ³•ï¼Œç®—æ³•æœ¬èº«å¹¶ä¸å¤æ‚ï¼Œé€šè¿‡ç†è§£åå‘ä¼ æ’­èƒ½å¤Ÿæ›´æ·±å…¥çš„ç†è§£ç¥ç»ç½‘ç»œçš„å·¥ä½œæ–¹å¼ã€‚æœ¬æ–‡ä»ä¸€ä¸ªåŒ–ç®€$\frac{\partial C}{\partial w}$å¾®åˆ†æ–¹ç¨‹çš„æ€è·¯ï¼Œå¾ªåºæ¸è¿›åœ°å¼•å‡ºåå‘ä¼ æ’­ç®—æ³•å…¬å¼ï¼Œæ³¨æ„è¿™ä¸æ˜¯ååˆ†ä¸¥æ ¼çš„æ•°å­¦æ¨å¯¼ã€‚

å½“ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—$\frac{\partial C}{\partial w}$ï¼Œå†æ ¹æ®

$$
w=w-\mathrm{\eta}\frac{\partial C}{\partial w}\tag{1}
$$

æ›´æ–°æƒé‡ï¼Œå…¶ä¸­$\mathrm{\eta}$ä¸ºå­¦ä¹ ç‡ã€‚

è€Œåœ¨åå‘ä¼ æ’­ç®—æ³•ä¸­ï¼Œæ›´æ–°$\frac{\partial C}{\partial w}$çš„è®¡ç®—å¤æ‚åº¦ä¸ºO(n)ï¼Œå¯ä»¥é€šè¿‡ä¸€æ¬¡æ­£å‘ä¼ æ’­å’Œä¸€æ¬¡åå‘ä¼ æ’­æ›´æ–°å…¨éƒ¨æƒé‡ã€‚

è¿™é‡Œæ¨è[ã€Šæ·±åº¦å­¦ä¹ ä¹‹ç¾ã€‹](https://zhuanlan.zhihu.com/p/44138371)ï¼Œåœ¨ä¼—å¤šçš„èµ„æºä¸­ï¼Œæˆ‘è®¤ä¸ºå…¶æ˜¯å½¢è±¡åŸºç¡€çš„ï¼Œæœ¬æ–‡ä¹Ÿå¤šå—å…¶å¯å‘ã€‚

## ç¬¦å·ä»‹ç»
å› ä¸ºä¼—å¤šçš„æ–‡ç« ä¹¦ç±å¹¶æ²¡æœ‰ç»Ÿä¸€çš„ç¬¦å·è§„èŒƒï¼Œè¿™é‡Œå…ˆå¯¹æœ¬æ–‡ä½¿ç”¨çš„ç¬¦å·è¿›è¡Œè§„èŒƒï¼Œä»¥å…å‘ç”Ÿæ··æ·†ï¼š

| ç¬¦å·                                   | æ„ä¹‰                                                      |
| -------------------------------------- | --------------------------------------------------------- |
| $L$                                    | è¡¨ç¤ºç½‘ç»œçš„æ€»å±‚æ•°                                          |
| $ğ‘¤_{ğ‘—,ğ‘˜}^{ğ‘™}$                          | è¡¨ç¤ºç¬¬$l-1$å±‚ç¬¬$k$ä¸ªç¥ç»å…ƒåˆ°ç¬¬$l$å±‚ç¬¬$j$ä¸ªç¥ç»å…ƒçš„æƒé‡$w$ |
| $b_{ğ‘—}^{ğ‘™}$                            | è¡¨ç¤ºç¬¬$l$å±‚ç¬¬$j$ä¸ªç¥ç»å…ƒçš„åç½®$b$                         |
| $a_{ğ‘—}^{ğ‘™}$                            | è¡¨ç¤ºç¬¬$l$å±‚ç¬¬$j$ä¸ªç¥ç»å…ƒçš„æ¿€æ´»å€¼$a$                       |
| $z_{j}^{l}=ğ‘¤_{ğ‘—}^{ğ‘™}a^{ğ‘™-1}+b_{ğ‘—}^{ğ‘™}$ | è¡¨ç¤ºç¬¬$l$å±‚ç¬¬$j$ä¸ªç¥ç»å…ƒçš„å¸¦æƒè¾“å…¥$z$                     |
| $a_{ğ‘—}^{ğ‘™}=\sigma(z_{j}^{l})$          | $\sigma$è¡¨ç¤ºsigmiodæ¿€æ´»å‡½æ•°                               |
| $C$                                    | ä»£ä»·å‡½æ•°                                                  |

<small>
ç²¾åŠ›æœ‰é™ï¼Œæ–‡ç« ä¸­æœªå¯¹å‘é‡ã€æ ‡é‡ã€çŸ©é˜µçš„è¡¨ç¤ºæ–¹å¼è¿›è¡Œä¸¥æ ¼åŒºåˆ†ï¼Œé€šå¸¸åªæœ‰ä¸Šæ ‡æ²¡æœ‰ä¸‹æ ‡çš„å‚æ•°ä¸ºå‘é‡ã€‚
</small>

## æ‹†è§£ç›´æ¥è®¡ç®—
æœ¬æ–‡ä»¥å¦‚ä¸‹å›¾çš„ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥æœºï¼ˆMLPï¼‰ä¸ºä¾‹ï¼Œä¸ºäº†ä½¿å…¬å¼æ›´åŠ ç®€æ´ï¼Œæˆ‘ä»¬**çœç•¥åç½®å’Œæ¿€æ´»å‡½æ•°**ã€‚

![](../asset/images/mlp_for_bp.png)

### æ­£å‘ä¼ æ’­
æˆ‘ä»¬é¦–å…ˆéœ€è¦å›é¡¾ä¸€ä¸‹æ­£å‘ä¼ æ’­çš„è¿‡ç¨‹ï¼Œå¯¹äºæœ¬æ–‡ç½‘ç»œï¼Œæœ€åä¸€å±‚çš„ç¥ç»å…ƒçš„æ¿€æ´»å€¼ä¸ºï¼š

$$
a^{4}=ğ‘¤^{4}\cdot(ğ‘¤^{3}\cdot(ğ‘¤^{2}\cdot a^{1}))\tag{2}
$$

å…¶ä¸­$ğ‘¤^{4}$ï¼Œ$ğ‘¤^{3}$ï¼Œ$ğ‘¤^{2}$åˆ†åˆ«ä¸º3-4å±‚ã€2-3å±‚ã€1-2å±‚çš„æƒé‡çŸ©é˜µï¼ˆå†æ¬¡æé†’å·²å¿½ç•¥åç½®å’Œæ¿€æ´»å‡½æ•°ï¼‰ã€‚ä»¥$ğ‘¤^{3}$ä¸ºä¾‹ï¼Œå…¶çŸ©é˜µä¸ºï¼š

$$
ğ‘¤^{3}=
\left[
\begin{matrix}
ğ‘¤_{1,1}^{3} & ğ‘¤_{1,2}^{3} \\
ğ‘¤_{2,1}^{3} & ğ‘¤_{2,2}^{3}  \\
\end{matrix}
\right] \tag{3}
$$

å½“ä½¿ç”¨å‡æ–¹è¯¯å·®ä½œä¸ºä»£ä»·å‡½æ•°æ—¶ï¼š

$$
C=\frac{1}{2}||y-a_{1}^{4}||^{2}\tag{4}
$$

å¯ä»¥çœ‹åˆ°å…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¤åˆå‡½æ•°ã€‚
### ç›´æ¥è®¡ç®—æ¢¯åº¦
åœ¨å…¬å¼ï¼ˆ2ï¼‰ä¸­ï¼ŒçŸ©é˜µä¹˜æ³•å¯ä»¥å†™ä¸ºçº¿æ€§æ–¹ç¨‹ç»„ï¼Œå› æ­¤ä»£ä»·å‡½æ•°å¯è¡¨ç¤ºä¸ºï¼š

$$
C=f(ğ‘¤_{1,1}^{1},ğ‘¤_{1,2}^{1},...,ğ‘¤_{1,2}^{4},ğ‘¤_{2,2}^{4})\tag{5}
$$

å³$C$å¯ä»¥è¡¨ç¤ºä¸ºè‡ªå˜é‡åªåŒ…æ‹¬å„æƒé‡çš„å‡½æ•°ï¼Œå› æ­¤æœ€ç®€å•çš„åŠæ³•æ˜¯å°†å…¶å…¬å¼å…¨éƒ¨åˆ†è§£å†è®¡ç®—ã€‚å¾ˆæ˜¾ç„¶å½“ç½‘ç»œè¾ƒå¤§æ—¶ï¼Œè¿™ç§åŠæ³•æ˜¯ä¸å¯è¡Œçš„ã€‚æœ¬èŠ‚çš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†ç†Ÿæ‚‰æ­£å‘ä¼ æ’­è¿‡ç¨‹ã€‚
## ä½¿ç”¨é“¾å¼æ³•åˆ™è®¡ç®—æ¢¯åº¦

### å¤åˆå‡½æ•°æ±‚å¯¼
åœ¨å¤§å­¦é«˜æ•°å¾®ç§¯åˆ†ä¸­é’ˆå¯¹å¤åˆå‡½æ•°å¯ä»¥ä½¿ç”¨é“¾å¼æ³•åˆ™å¿«é€Ÿæ±‚è§£ï¼Œæœ‰æ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨ä¸­é—´å˜é‡æ–¹ä¾¿æ±‚å¯¼ã€‚
å…¶åŸºæœ¬å…¬å¼ä¸ºï¼š

$$
\frac{\partial z}{\partial x}=\frac{\partial z}{\partial t}\cdot\frac{\partial t}{\partial x}\tag{6}
$$

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•è®¡ç®—å‡ºï¼š

$$
\frac{\partial C}{\partial ğ‘¤_{1,1}^{4}}=\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial ğ‘¤_{1,1}^{4}}\tag{7}
$$

$$
\frac{\partial C}{\partial ğ‘¤_{1,1}^{3}}=\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial a_{1}^{3}}\frac{\partial a_{1}^{3}}{\partial ğ‘¤_{1,1}^{3}}\tag{8}
$$

$$
\frac{\partial C}{\partial ğ‘¤_{2,1}^{3}}=\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial a_{2}^{3}}\frac{\partial a_{2}^{3}}{\partial ğ‘¤_{1,1}^{3}}\tag{9}
$$

$$
\frac{\partial C}{\partial ğ‘¤_{1,2}^{3}}=\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial a_{1}^{3}}\frac{\partial a_{1}^{3}}{\partial ğ‘¤_{1,2}^{3}}\tag{10}
$$

è¿™ä½¿å¾—æˆ‘ä»¬ä¸ç”¨å°†å…¬å¼(2)å…¨éƒ¨åˆ†è§£ä¸ºå…¬å¼(5)ä¹Ÿèƒ½è®¡ç®—éƒ¨åˆ†æ¢¯åº¦ã€‚
### é“¾å¼æ³•åˆ™
ç„¶è€Œæœ‰çš„æ—¶å€™é€‰æ‹©åˆé€‚çš„ä¸€ä¸ª$t$æ˜¯å¾ˆéš¾çš„ï¼Œå› ä¸ºå¾€å¾€å¾®åˆ†ä¸æ˜¯â€œå•é“¾çš„â€ï¼Œæ¯”å¦‚è®¡ç®—$\frac{\partial C}{\partial ğ‘¤_{1,1}^{2}}$ï¼š

$$
\frac{\partial C}{\partial ğ‘¤_{1,1}^{2}}=\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial z_{1}^{4}}...\frac{\partial z_{1}^{4}}{\partial ğ‘¤_{1,1}^{2}}\tag{11}
$$

å…¬å¼ä¸­çš„$...$è¯¥å¦‚ä½•å¡«å†™ï¼Ÿè¿™é‡Œæˆ‘ä»¬éœ€è¦æ‰©å……å¤åˆå‡½æ•°æ±‚å¯¼ï¼Œæœ¬èŠ‚ä¸»è¦æ‘˜é€‰è‡ªChristopher Olahçš„[blog](http://colah.github.io/posts/2015-08-Backprop/)ã€‚

å¯¹äºï¼š

$$
c=a+b\\
d=b+1\\
e=c\times d\\\tag{12}
$$

æˆ‘ä»¬å¯ä»¥ç”Ÿæˆå¦‚ä¸‹å›¾çš„å›¾å½¢åŒ–è¡¨ç¤ºï¼Œè¯¥å›¾ç§°ä¸ºè®¡ç®—å›¾ï¼ˆComputational Graphsï¼Œæ˜¯é“¾å¼æ³•åˆ™çš„ä¸€ç§å›¾å½¢åŒ–è¡¨ç¤ºã€‚

<Zoom> <img alt="è®¡ç®—å›¾" src={useBaseUrl('img/blog/computational_graph_for_bp.png')} /> </Zoom>

å¯¹äºæ±‚è§£$\frac{\partial e}{\partial a}$ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°aåªé€šè¿‡å½±å“cæœ€ç»ˆå½±å“eçš„ç»“æœï¼Œå³åªæœ‰ä¸€æ¡a->c->eä¸€æ¡è·¯å¾„ã€‚å› æ­¤ï¼š

$$
\frac{\partial e}{\partial a}=\frac{\partial e}{\partial c}\frac{\partial c}{\partial a}
$$

<small>ä½¿ç”¨â€œå½±å“â€è¿™ä¸ªè¯å¯èƒ½æ˜¾å¾—å¹¶ä¸ä¸“ä¸šä¸”è¾ƒä¸ºæŠ½è±¡ã€‚</small>

å¯¹äºæ±‚è§£$\frac{\partial e}{\partial b}$ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°bé€šè¿‡å½±å“cå’Œdä¸¤æ¡è·¯å¾„æœ€ç»ˆå½±å“eçš„ç»“æœï¼Œå³åŒ…æ‹¬b->c->eã€b->d->eä¸¤æ¡è·¯å¾„ï¼Œå¹¶ä¸æ˜¯â€œå•é“¾çš„â€ï¼Œå› æ­¤ï¼š

$$
\frac{\partial e}{\partial b}=\frac{\partial cd}{\partial b}=d\frac{\partial c}{\partial b}+c\frac{\partial d}{\partial b}=\frac{\partial e}{\partial c}\frac{\partial c}{\partial b}+\frac{\partial e}{\partial d}\frac{\partial d}{\partial b}
$$

æˆ‘ä»¬å¯ä»¥å°†æ­¤æ±‚å¾®åˆ†çš„æ–¹æ³•æ€»ç»“ä¸º**åŒä¸€æ¡è·¯å¾„çš„èŠ‚ç‚¹ç›¸ä¹˜ï¼Œæœ€åå°†æ‰€æœ‰çš„è·¯å¾„ç›¸åŠ **ã€‚

<small>
æ³¨æ„ç»“ç‚¹ä¹‹é—´ç›¸ä¹˜æ˜¯å› ä¸ºå¤åˆå‡½æ•°æ±‚å¯¼å…¬å¼(6)ï¼Œå½“ä½¿ç”¨ä¸­é—´å˜é‡æ—¶éœ€è¦ä½¿ç”¨ä¹˜æ³•ã€‚

æ‰€æœ‰è·¯å¾„ç›¸åŠ æ˜¯ä¾æ®å…¨å¾®åˆ†å…¬å¼ï¼Œå½“æœ‰å¤šä¸ªä¸­é—´å˜é‡æ—¶éœ€è¦ä½¿ç”¨åŠ æ³•ã€‚

è·¯å¾„çš„åŠ æ³•å’Œä¹˜æ³•ä¸å…¬å¼(11)ä¸­å„å­å¼ä¸­çš„è¿ç®—ç¬¦å·æ˜¯æ— å…³çš„ï¼Œå…¬å¼ä¸­çš„åŠ æ³•å’Œä¹˜æ³•åªå½±å“å¦‚$\frac{\partial e}{\partial c}$ã€$\frac{\partial c}{\partial a}$çš„æ±‚è§£ï¼Œè¯·æ³¨æ„åŒºåˆ†ã€‚
</small>

### ä½¿ç”¨é“¾å¼æ³•åˆ™è®¡ç®—æ¢¯åº¦
æ ¹æ®é“¾å¼æ³•åˆ™æˆ‘ä»¬ç°åœ¨å¯ä»¥æ±‚å‡º$\frac{\partial C}{\partial ğ‘¤_{1,1}^{2}}$ï¼Œå¯ä»¥çœ‹åˆ°$ğ‘¤_{1,1}^{2}$æœ‰$a_{1}^{2}$->$a_{1}^{3}$->$a_{1}^{4}$å’Œ$a_{1}^{2}$->$a_{2}^{3}$->$a_{1}^{4}$ä¸¤æ¡è·¯å¾„ï¼Œå› æ­¤ï¼š

$$
\frac{\partial C}{\partial ğ‘¤_{1,1}^{2}}=
\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial a_{1}^{3}}\frac{\partial a_{1}^{3}}{\partial a_{1}^{2}}\frac{\partial a_{1}^{2}}{\partial ğ‘¤_{1,1}^{2}}+
\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial a_{2}^{3}}\frac{\partial a_{2}^{3}}{\partial a_{1}^{2}}\frac{\partial a_{1}^{2}}{\partial ğ‘¤_{1,1}^{2}}\\
=(\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial a_{1}^{3}}\frac{\partial a_{1}^{3}}{\partial a_{1}^{2}}+\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial a_{2}^{3}}\frac{\partial a_{2}^{3}}{\partial a_{1}^{2}})\frac{\partial a_{1}^{2}}{\partial ğ‘¤_{1,1}^{2}}\tag{12}
$$

## åå‘ä¼ æ’­äºŒæ¬¡ç®€åŒ–æ¢¯åº¦è®¡ç®—
åˆ°ç°åœ¨æˆ‘ä»¬å·²ç»ä»ç®€å•ç²—æš´çš„æ‹†è§£ç›´æ¥è®¡ç®—ï¼Œåˆ°ä½¿ç”¨é“¾å¼æ³•åˆ™ç®€åŒ–è®¡ç®—ã€‚è¿™è·ç¦»åå‘ä¼ æ’­åªå‰©ä¸€æ­¥ä¹‹é¥äº†ã€‚
### é“¾å¼æ³•åˆ™çš„é—®é¢˜
é€šè¿‡å¯¹æ¯”å…¬å¼(7)ã€(8)ã€(9)ã€(10)ã€(11)æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¶ä¸­å‡æœ‰$\frac{\partial C}{\partial a_{1}^{4}}$ä¸€é¡¹ï¼Œå¯¹æ¯”(8)ã€(10)ã€(11)ï¼Œå…¶ä¸­å‡æœ‰$\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial a_{1}^{3}}$ä¸€é¡¹ï¼Œå…¬å¼(11)ç”šè‡³å¯ä»¥åŒ–ç®€ã€‚å¦‚æœä½ æŠŠå…¨éƒ¨æ¢¯åº¦å†™å‡ºï¼Œä½ å°±èƒ½å‘ç°æ›´å¤šçš„é‡å¤é¡¹ã€‚åå‘ä¼ æ’­ç®—æ³•çš„å¼ºå¤§ä¹‹ä¸€å°±æ˜¯é¿å…äº†è¿™äº›é‡å¤è®¡ç®—ã€‚
### å¼•å…¥è¯¯å·®
è¿™é‡Œæˆ‘ä»¬å¼•å…¥è¯¯å·®è¿™ä¸€æ¦‚å¿µï¼Œæˆ‘ä»¬è§„å®šç¥ç»å…ƒçš„è¯¯å·®ä¸º(è¿™é‡Œæˆ‘ä»¬ä»ç„¶å¿½ç•¥åç½®å’Œæ¿€æ´»å‡½æ•°)ï¼š

$$
\delta_{j}^{l}=\frac{\partial C}{\partial a_{j}^{l}}\tag{13}
$$

å¯å¾—ï¼š

$$
\frac{\partial C}{\partial ğ‘¤_{j,k}^{l}}=\frac{\partial C}{\partial a_{j}^{l}}\frac{\partial a_{j}^{l}}{\partial ğ‘¤_{j,k}^{l}}=\delta_{j}^{l}\frac{\partial a_{j}^{l}}{\partial ğ‘¤_{j,k}^{l}}\tag{14}
$$

å³æˆ‘ä»¬å¯ä»¥æŠŠå¯¹$\frac{\partial C}{\partial ğ‘¤_{j,k}^{l}}$çš„æ±‚è§£è½¬åŒ–ä¸ºå¯¹$\delta_{j}^{l}$çš„æ±‚è§£ã€‚é‚£æˆ‘ä»¬è¯¥å¦‚ä½•æ±‚å‡ºæ‰€æœ‰$\delta_{j}^{l}$å‘¢ï¼Ÿæˆ‘ä»¬å…ˆå›åˆ°ä¹‹å‰ä»‹ç»çš„ä¾‹å­ä¸­ã€‚

é¦–å…ˆï¼Œåœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œæ ¹æ®$a_{j}^{l}=\sum_{k}w_{j,k}^{l}\cdot a_{k}^{l-1}$å¯å¾—ï¼š

$$
\frac{\partial a_{j}^{l}}{\partial a_{k}^{l-1}}=ğ‘¤_{ğ‘—,ğ‘˜}^{ğ‘™}\tag{15}
$$

ä»å…¬å¼ï¼ˆ7ï¼‰ä¸­å¯å¾—ï¼š

$$
\delta_{1}^{4}=\frac{\partial C}{\partial a_{1}^{4}}\tag{16}
$$

ä»å…¬å¼ï¼ˆ8ï¼‰ä¸­å¯å¾—ï¼š

$$
\delta_{1}^{3}=\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial a_{1}^{3}}=\delta_{1}^{4}\frac{\partial a_{1}^{4}}{\partial a_{1}^{3}}=\delta_{1}^{4}w_{1,1}^{4}\tag{17}
$$

ä»å…¬å¼ï¼ˆ12ï¼‰ä¸­å¯å¾—ï¼š

$$
\delta_{1}^{2}=(\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial a_{1}^{3}})\frac{\partial a_{1}^{3}}{\partial a_{1}^{2}}+(\frac{\partial C}{\partial a_{1}^{4}}\frac{\partial a_{1}^{4}}{\partial a_{2}^{3}})\frac{\partial a_{2}^{3}}{\partial a_{1}^{2}}=\delta_{1}^{3}\frac{\partial a_{1}^{3}}{\partial a_{1}^{2}}+\delta_{2}^{3}\frac{\partial a_{2}^{3}}{\partial a_{1}^{2}}
=\delta_{1}^{3}w_{1,1}^{3}+\delta_{2}^{3}w_{2,1}^{3}\tag{18}
$$

æˆ‘ä»¬å¯ä»¥ç²—ç•¥çš„å½’çº³æ€»ç»“ä¸ºï¼Œç¬¬lå±‚çš„$\delta^{l}$éƒ½å¯ä»¥ä»ç¬¬$l+1$å±‚çš„$\delta^{l+1}$æ±‚å¾—ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ä»æœ€åä¸€å±‚å¼€å§‹ï¼Œä»åå¾€å‰æ±‚å¾—æ‰€æœ‰$\delta_{j}^{l}$å†æœ€ç»ˆæ±‚å¾—$\frac{\partial C}{\partial ğ‘¤_{j,k}^{l}}$ï¼Œè¿™ä¾¿æ˜¯åå‘ä¼ æ’­ç®—æ³•çš„å¤§è‡´æ±‚è§£è¿‡ç¨‹ã€‚
### çŸ©é˜µè¡¨ç¤º
æˆ‘ä»¬å¯¹å…¬å¼ï¼ˆ18ï¼‰æ‹“å±•ä¸ºçŸ©é˜µè¡¨ç¤º

$$
\left[\begin{matrix}\delta_{1}^{2} \\\delta_{2}^{2} \\\end{matrix}\right] 
=\left[\begin{matrix}\frac{\partial a_{1}^{3}}{\partial a_{1}^{2}} &\frac{\partial a_{2}^{3}}{\partial a_{1}^{2}}\\\frac{\partial a_{1}^{3}}{\partial a_{2}^{2}} &\frac{\partial a_{2}^{3}}{\partial a_{2}^{2}}\\\end{matrix}\right]\left[\begin{matrix}\delta_{1}^{3} \\\delta_{2}^{3} \\\end{matrix}\right]
=\left[\begin{matrix}w_{1,1}^{3} &w_{2,1}^{3}\\w_{1,2}^{3} &w_{2,2}^{3}\\\end{matrix}\right]\left[\begin{matrix}\delta_{1}^{3} \\\delta_{2}^{3} \\\end{matrix}\right]\tag{19}
$$

å…¬å¼19ä¸­çš„2*2çŸ©é˜µå¯ä»¥ç†è§£ä¸ºå‘é‡$a^{2}$å¯¹å‘é‡$a^{3}$çš„ä¸€é˜¶åå¯¼ï¼Œå³[é›…å¯æ¯”çŸ©é˜µ](https://zh.wikipedia.org/wiki/%E9%9B%85%E5%8F%AF%E6%AF%94%E7%9F%A9%E9%98%B5)çš„**è½¬ç½®**ã€‚å› æ­¤åªè¦è®¡ç®—æ¯ä¸€å±‚å¯¹åº”çš„é›…å¯æ¯”çŸ©é˜µï¼ˆå¯¹äºMLPæ¥è¯´ï¼Œé›…å¯æ¯”çŸ©é˜µä¸ºæ¯å±‚çš„æƒé‡ç³»æ•°çŸ©é˜µï¼‰ã€‚ä¾¿å¯ä»¥ä½¿ç”¨çŸ©é˜µå¿«é€Ÿè®¡ç®—æ¯å±‚è¯¯å·®$\delta_{j}^{l}$ã€‚
å…¬å¼19å¯ç®€åŒ–ä¸ºï¼š

$$
\delta^{2}=(w^{3})^{T}\cdot\delta^{3}\tag{20}
$$

## åå‘ä¼ æ’­ç®—æ³•ä»‹ç»
è¿™é‡Œæˆ‘ä»¬åŠ å…¥åç½®å’Œæ¿€æ´»å‡½æ•°ï¼Œç»™å‡ºå®Œæ•´çš„åå‘ä¼ æ’­ç®—æ³•ï¼ˆè€ƒè™‘åç½®å’Œæ¿€æ´»å‡½æ•°ï¼Œä½†æœªè€ƒè™‘æ­£åˆ™é¡¹ï¼‰ï¼Œè¯¥ç®—æ³•åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªå…¬å¼ï¼Œæ‘˜è‡ª[ã€ŠNeural Networks and Deep Learningã€‹](http://neuralnetworksanddeeplearning.com/chap2.html):

$$
\delta^{L}=\nabla_{a}C\odot\sigma'(z^{L})\tag{BP1}
$$

$$
\delta^{l}=((w^{l+1})^{T}\delta^{l+1})\odot\sigma'(z^{l})\tag{BP2}
$$

$$
\frac{\partial C}{\partial b_{j}^{l}}=\delta_{j}^{l}\tag{BP3}
$$

$$
\frac{\partial C}{\partial ğ‘¤_{j,k}^{l}}=a_{k}^{l-1}\delta_{j}^{l}\tag{BP4}
$$

BP1å’ŒBP2ä¸­æ¶‰åŠåˆ°å‘é‡çš„è®¡ç®—ï¼Œå…¶ä¸­$\odot$è¡¨ç¤ºå“ˆè¾¾ç›ç§¯ã€‚$\nabla_{a}C$è¡¨ç¤ºè¾“å‡º$a$å¯¹æŸå¤±$C$çš„æ¢¯åº¦ã€‚$\sigma'$è¡¨ç¤ºå¯¹æ¿€æ´»å‡½æ•°æ±‚åå¯¼ã€‚

åå‘ä¼ æ’­ç®—æ³•çš„å®ç°å³é¦–å…ˆè®¡ç®—BP1è·å¾—æœ€åä¸€å±‚è¯¯å·®$\delta^{L}$ï¼Œæ¥ä¸‹æ¥ä»åå¾€å‰æ ¹æ®BP2ä¾æ¬¡æ±‚å‡ºå„å±‚çš„$\delta^{l}$ï¼Œæœ€åæ ¹æ®å…¬å¼BP3å’ŒBP4æ±‚å‡ºå„å±‚åç½®å’Œæƒé‡çš„æ¢¯åº¦ã€‚

ä»¥ä¸‹ç»™å‡ºBP1å’ŒBP2ä¸¤ä¸ªå…¬å¼çš„æ ‡é‡è¡¨ç¤ºï¼Œä¾¿äºç†è§£ï¼š

$$
\delta_{j}^{L}=\frac{\partial C}{\partial a_{j}^{L}}\frac{\partial a_{j}^{L}}{\partial z_{j}^{L}}\tag{BP1-2}
$$

$$
\delta_{j}^{l}=\sum_{q}(w_{q,j}^{l+1}\times\delta_{q}^{l+1})\frac{\partial a_{j}^{l}}{\partial z_{j}^{l}}\tag{BP2-2}
$$

å…¬å¼BP2-2ä¸­$q$è¡¨ç¤º$l+1$å±‚çš„$q$ä¸ªç¥ç»å…ƒã€‚

## æ€»ç»“
ä»é“¾å¼æ³•åˆ™åˆ°é“¾å¼æ³•åˆ™å†åˆ°BPç®—æ³•ï¼Œå¯èƒ½è¿™ç§ç†è§£æ–¹å¼å¦‚Michael Nielsenåœ¨ã€ŠNeural Networks and Deep Learningã€‹ä¸­æ‰€å†™æ˜¯æ¯”è¾ƒâ€œæ— è¶£çš„â€ã€‚ä½†æ˜¯ç¿»é˜…ç½‘ç»œä¸Šçš„èµ„æ–™ï¼Œä¸æ˜¯è¿‡äºæŠ½è±¡å°±æ˜¯è¿‡äºç®€é™‹ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œè¿™ç§å¯å‘å¼çš„ç†è§£ï¼Œå¾€å¾€æ›´æ·±åˆ»ã€‚